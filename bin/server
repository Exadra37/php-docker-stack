#!/bin/bash

set -e

source ./vendor/exadra37-docker-compose/php7-docker-stack/bin/php7-docker-stack-setup.sh
source ./vendor/exadra37-docker-compose/php7-docker-stack/bin/docker-pull-from-env-vars.sh

if [ "--setup-docker-stack" == "${1}" ]
    then
        setupDockerStack
        exit 0
fi

# For first run we want to ensure that the ./docker folder exists in the project.
if [ ! -d ./docker ]
    then
        setupDockerStack
fi

pull_Docker_Images

exit 0

# We need to ensure that if Php7 Docker Stack is used in more than 1 project, in same machine, Docker compose is able to
#  create unique names for the Docker containers in each project.
PROJECT_NAME=${PWD##*/}

# we want to use the App root as the project directory for docker-compose so that he can read the .env file.
sudo docker-compose \
    -p "${PROJECT_NAME}" \
    --project-directory "${PWD}" \
    --file vendor/exadra37-docker-compose/php7-docker-stack/src/docker-compose.yml "${@}"
